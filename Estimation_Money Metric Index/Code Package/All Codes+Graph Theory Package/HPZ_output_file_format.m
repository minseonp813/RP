function [boot_flag,file_val_str] = HPZ_output_file_format(aggregation_flag, metric_flag)
%% the following is specific information needed for output file format
%
global output_flag_vec

global write_all_flag

    file_val_str = {'Value', 'Value', 'Value', 'Value', 'Value', 'Value'};
    if metric_flag ~= 0 %NLLS
        file_val_str{metric_flag} = 'Criterion';
    elseif aggregation_flag ~= 0 %MME
        file_val_str{aggregation_flag + 2} = 'Criterion';
    else %BI
        file_val_str{6} = 'Criterion';
    end
    
    %% initializing output settings
    output_flag_vec = false(1, 6);

    file_setting_op_val = zeros(1, 6);
    file_setting_op_enable = {'on','on','on','on','on','on'}; 
	
    if metric_flag == 1 % Euc
        file_setting_op_val(1) = 0;
        file_setting_op_enable{1} = 'off';
    elseif metric_flag == 2 %CFGK
        file_setting_op_val(2) = 0;
        file_setting_op_enable{2} = 'off';
        
    end
    
    if aggregation_flag == 1
        file_setting_op_val(3) = 0;
        file_setting_op_enable{3} = 'off';
    elseif aggregation_flag == 2
        file_setting_op_val(4) = 0;
        file_setting_op_enable{4} = 'off';
    elseif aggregation_flag == 3
        file_setting_op_val(5) = 0;
        file_setting_op_enable{5} = 'off';
    end
    
    if (aggregation_flag == 0) && (metric_flag == 0)
        file_setting_op_val(6) = 0;
        file_setting_op_enable{6} = 'off';
    end        
    
    % create the gui figure
    sz = [350 450]; % figure size
    screensize = get(0,'ScreenSize');
    xpos = ceil((screensize(3)-sz(2))/2); % center the figure on the
    ypos = ceil((screensize(4)-sz(1))/2); % center the figure on the
    S.fh = figure('units','pixels',...
                          'position',[xpos, ypos, sz(2), sz(1)],...
                          'menubar','none',...
                          'name','Output File Format',...
                          'numbertitle','off',...
                          'resize','off');

    %% Options
    S.bg_fs = uibuttongroup('units','pix',...
                         'title', 'Options', ...
                         'pos',[25 150 400 200]);
                     
    S.label_ffs(1) = uicontrol(S.bg_fs,...
                     'style','text',...
                     'units','pix',...
                     'position',[10 155 380 30],...
                     'fontsize',12,'fontweight','bold',... 
                     'string','Select the values needed for the output file');

%     S.label_ffs(2) = uicontrol(S.bg_fs,...
%                      'style','text',...
%                      'units','pix',...
%                      'position',[10 200 250 30],...
%                      'fontsize',12,'fontweight','bold',... 
%                      'string','like to appear in the output file:');                
%                     
    S.file_setting_op(1) = uicontrol(S.bg_fs,...
                        'style','check',...
                        'unit','pix',...
                        'enable', file_setting_op_enable{1}, ...
                        'value', file_setting_op_val(1), ...
                        'position',[30 135 350 30],...
                        'string',strcat(' NLLS ',{' '}, file_val_str{1},' based on Euclidean Metric'));
                    
    S.file_setting_op(2) = uicontrol(S.bg_fs,...
                        'style','check',...
                        'enable', file_setting_op_enable{2}, ...
                        'value', file_setting_op_val(2), ...
                        'unit','pix',...
                        'position',[30 110 350 30],...
                        'string',strcat(' NLLS ',{' '},  file_val_str{2},' based on CFGK Metric'));

    S.file_setting_op(3) = uicontrol(S.bg_fs,...
                        'style','check',...
                        'unit','pix',...
                        'enable', file_setting_op_enable{3}, ...
                        'value', file_setting_op_val(3), ...
                        'position',[30 85 350 30],...
                        'string',strcat(' MME ',{' '}, file_val_str{3},' based on MAX Waste'));
                    
    S.file_setting_op(4) = uicontrol(S.bg_fs,...
                        'style','check',...
                        'unit','pix',...
                        'enable', file_setting_op_enable{4}, ...
                        'value', file_setting_op_val(4), ...
                        'position',[30 60 350 30],...
                        'string',strcat(' MME ',{' '}, file_val_str{4},' based on MEAN Waste'));
                    
    S.file_setting_op(5) = uicontrol(S.bg_fs,...
                        'style','check',...
                        'unit','pix',...
                        'enable', file_setting_op_enable{5}, ...
                        'value', file_setting_op_val(5), ...
                        'position',[30 35 350 30],...
                        'string', strcat(' MME ',{' '}, file_val_str{5},' based on AVG(SSQ(Wastes))'));

    S.file_setting_op(6) = uicontrol(S.bg_fs,...
                        'style','check',...
                        'unit','pix',...
                        'enable', file_setting_op_enable{6}, ...
                        'value', file_setting_op_val(6), ...
                        'position',[30 10 350 30],...
                        'string',strcat(' BI ',{' '}, file_val_str{6}));                    
    %% end of settings
    
%% Functional Forms
S.bg_ff = uibuttongroup('units','pix',...
    'title', 'Show only the best parameters', ...
    'pos',[25 90 400 50]);

S.functional_form_rd(1) = uicontrol(S.bg_ff,...
    'value', 1.0,...    
    'style','rad',...
    'unit','pix',...
    'position',[25 10 80 20],...
    'string',' YES');
% S.functional_form_rd(2) = uicontrol(S.bg_ff,...
%     'enable','off', ...
%     'style','rad',...
%     'unit','pix',...
%     'position',[275 5 80 30],...
%     'string',' Others');
S.functional_form_rd(2) = uicontrol(S.bg_ff,...
    'enable','on', ...
    'style','rad',...
    'unit','pix',...
    'position',[150 10 80 20],...
    'string',' NO');    

%% Functional Forms
S.se_ff = uibuttongroup('units','pix',...
    'title', 'Calculate Simulated Standard Errors', ...
    'pos',[25 40 400 50]);

S.functional_form_se(1) = uicontrol(S.se_ff,...
    'style','rad',...
    'unit','pix',...
    'position',[25 10 80 20],...
    'string',' YES');
% S.functional_form_rd(2) = uicontrol(S.bg_ff,...
%     'enable','off', ...
%     'style','rad',...
%     'unit','pix',...
%     'position',[275 5 80 30],...
%     'string',' Others');
S.functional_form_se(2) = uicontrol(S.se_ff,...
    'value', 1.0,...    
    'enable','on', ...    
    'style','rad',...
    'unit','pix',...
    'position',[150 10 80 20],...
    'string',' NO');    

    S.pb = uicontrol('style','push',...
                     'unit','pix',...
                     'position',[170 5 100 30],...
                     'string','OK',...
                     'callback',{@pb_call,S});

    uiwait(S.fh)  % Prevent all other processes from starting until closed.
    
    %% OK button
    function [] = pb_call(varargin)
        % Callback for pushbutton.
        S = varargin{3};  % Get the structure.
        % Instead of switch, we could use num2str on:   
        % find(get(S.bg,'selectedobject')==S.rd)      (or similar)
        % Note the use of findobj.  This is because of a BUG in MATLAB, whereby if
        % the user selects the same button twice, the selectedobject property will
        % not work correctly.

        output_flag_temp = cell2mat(get(S.file_setting_op(:), 'value'));
        
        output_flag_vec = output_flag_temp';
        
        if strcmp(get(S.file_setting_op(1), 'enable'), 'off') == true
            output_flag_vec(1) = true;
        elseif strcmp(get(S.file_setting_op(2), 'enable'), 'off') == true
            output_flag_vec(2) = true;

        end

        if strcmp(get(S.file_setting_op(3), 'enable'), 'off') == true
            output_flag_vec(3) = true;
        elseif strcmp(get(S.file_setting_op(4), 'enable'), 'off') == true
            output_flag_vec(4) = true;
        elseif strcmp(get(S.file_setting_op(5), 'enable'), 'off') == true
            output_flag_vec(5) = true;
        end

        if strcmp(get(S.file_setting_op(6), 'enable'), 'off') == true
            output_flag_vec(6) = true;
        end
        
        %% Setting Functional Form
        switch findobj(get(S.bg_ff,'selectedobject'))
            case S.functional_form_rd(1)
                % YES
                write_all_flag = 1;
                
            case S.functional_form_rd(2)
                % NO
                write_all_flag = 0;
                % Zeros_Flag
%                 zeros_flag = 1; % zeros are allowed
                
%             case S.functional_form_rd(2)
%                 % Others
%                 function_flag = 3;
%                 % Zeros_Flag
%                 zeros_flag = 1; % zeros are allowed
        end

        %% Setting Functional Form
        switch findobj(get(S.se_ff,'selectedobject'))
            case S.functional_form_se(1)
                % YES
                boot_flag = 1;
                
            case S.functional_form_se(2)
                % NO
                boot_flag = 0;
                % Zeros_Flag
%                 zeros_flag = 1; % zeros are allowed
                
%             case S.functional_form_rd(2)
%                 % Others
%                 function_flag = 3;
%                 % Zeros_Flag
%                 zeros_flag = 1; % zeros are allowed
        end        
        
        % close the window
        close(S.fh);

    end

end